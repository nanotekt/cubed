-- Wire Routing Chain (from counter.aforth)
-- Models the GA144 "wire node" pattern where intermediate
-- nodes relay data between distant nodes on the chip.
--
-- In the reference, nodes 714-710 each run a simple
-- wire loop: read from east, write to west.
-- This creates a 5-hop data relay from node 715 (crystal)
-- to node 709 (counter/serial output).
--
-- Pattern: each wire node does @ !b wire (read, write, repeat)
-- This is fundamental to GA144 programming since nodes
-- can only talk to direct neighbors.

-- Source node: generates values
node 715

/\

-- Wire relay function: read from one port, write to another.
-- Models the F18A pattern: east a! west b! @ !b (loop)
wire_relay = lambda{inp:Int, out:Int}.
  (recv{port=0x1D5, value=inp} /\
   send{port=0x175, value=inp} /\
   out = inp)

/\

-- Simple value passthrough (identity relay)
wire_pass = lambda{val:Int, out:Int}.
  out = val

/\

-- 5 chained wire nodes relay a value from east to west
-- Node 714: relay east->west
wire_relay{inp=hop1, out=r1}

/\

-- Node 713: relay
wire_relay{inp=hop2, out=r2}

/\

-- Node 712: relay
wire_relay{inp=hop3, out=r3}

/\

-- Node 711: relay
wire_relay{inp=hop4, out=r4}

/\

-- Node 710: relay
wire_relay{inp=hop5, out=r5}

/\

-- Source: send initial value (crystal counter tick)
send{port=0x175, value=42}
